# 📈 Arbitrade

## 📋 項目概述
專業的加密貨幣套利交易平台，支援跨交易所的差價套利和TWAP（時間加權平均價格）執行策略。系統能夠即時監控多個交易所的bid1/ask1價格，並在發現套利機會時自動執行雙腿訂單。

### 🎯 設計特色
- **專業交易界面**：簡潔高效的現代化設計
- **即時價差監控**：精確監控bid1/ask1價格差異
- **用戶自定義配置**：靈活的交易對選擇和參數設定
- **一鍵雙邊下單**：快速執行套利交易
- **智能風險控制**：完善的風險管理機制

## 核心功能

### 1. API 請求優化
- **防抖機制**：使用防抖服務控制 API 請求頻率，避免過於頻繁的請求
- **智能延遲**：TWAP 頁面載入交易對時添加 1 秒延遲
- **頻率限制**：最多每分鐘 10 次請求，超過限制自動忽略
- **定時器優化**：Dashboard 10秒刷新，ArbitragePage 60秒刷新，TWAP 60秒刷新

### 2. 雙腿套利交易
- **跨交易所套利**：同時在兩個不同交易所執行相反方向的交易
- **現貨套利**：利用不同交易所現貨價格差異進行套利
- **合約套利**：利用期貨合約價格差異進行套利
- **現合套利**：現貨與合約之間的價差套利

### 3. 差價鎖定功能
- **自動監控**：即時監控設定交易對的價格差異
- **觸發執行**：當價差達到預設閾值時自動執行交易
- **風險控制**：內建止損和資金管理機制

### 4. TWAP執行策略
- **時間分散**：將大額訂單分散在設定時間窗口內執行
- **價格優化**：通過時間加權平均獲得更好的執行價格
- **市場影響最小化**：減少大額交易對市場價格的衝擊

### 5. 即時監控面板
- **價差監控**：即時顯示各交易對的價差情況
- **倉位管理**：顯示當前持倉和盈虧狀況
- **交易記錄**：完整的交易歷史和績效分析

## 技術架構

### 前端技術棧
- **框架**：React 18 + TypeScript
- **UI庫**：Ant Design + TradingView圖表
- **狀態管理**：Redux Toolkit
- **即時通訊**：WebSocket連接
- **圖表展示**：TradingView Charting Library
- **API優化**：防抖服務控制請求頻率

### 後端技術棧
- **運行環境**：Node.js + Express
- **數據庫**：MongoDB（交易記錄）+ Redis（快取）
- **交易所API**：支援多家主流交易所API
- **即時數據**：WebSocket數據流
- **風險控制**：內建風險管理模組

### 系統架構
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   後端API      │    │   交易所API     │
│   React App     │◄──►│   Express       │◄──►│   Binance       │
│   - 交易面板    │    │   - 套利引擎    │    │   OKX           │
│   - 監控圖表    │    │   - 風險控制    │    │   Bybit         │
│   - 歷史記錄    │    │   - 數據管理    │    │   ...           │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │              ┌─────────────────┐              │
         └──────────────►│   數據庫層      │◄─────────────┘
                        │   MongoDB       │
                        │   Redis Cache   │
                        └─────────────────┘
```

## 主要模組

### 1. 交易引擎模組
- **套利檢測**：即時計算價差並判斷套利機會
- **訂單執行**：同步執行雙腿訂單
- **倉位管理**：追蹤和管理所有開倉位置
- **風險控制**：監控風險指標並執行保護措施

### 2. 數據管理模組
- **價格數據**：收集和處理各交易所價格數據
- **交易記錄**：記錄所有交易明細和績效
- **用戶配置**：管理用戶的交易參數和偏好設定

### 3. 用戶界面模組
- **交易面板**：設定和執行套利策略
- **監控儀表板**：即時顯示市場數據和交易狀態
- **分析報告**：提供詳細的績效分析和統計

## 安全特性
- **API密鑰加密**：所有交易所API密鑰均採用加密存儲
- **權限控制**：細粒度的用戶權限管理
- **交易限額**：可設定的交易金額和頻率限制
- **異常監控**：自動檢測和處理異常交易情況

## 部署說明
- **開發環境**：支援本地開發和測試
- **生產環境**：可部署至雲端服務器
- **監控告警**：集成系統監控和告警機制

## 使用指南

### 快速開始
1. 設定交易所API密鑰
2. 選擇要監控的交易對
3. 設定套利參數（價差閾值、交易金額等）
4. 啟動自動套利監控
5. 查看交易結果和績效報告
### 實時價格 API（新）
- `GET /api/monitoring/prices`
  - 功能：回傳所有監控交易對的最新 bid1/ask1、價差與是否觸發
  - 回應：`ArbitrageOpportunity[]`（包含 `leg1Price/leg2Price/spread/spreadPercent/timestamp`）
  - 前端使用位置：`client/src/pages/ArbitragePage.tsx`（「實時價格」欄位）


### ⚠️ 風險提醒
- **本系統使用真實交易平台（非測試網）**，所有交易都將在實際市場中執行
- 套利交易存在市場風險，請謹慎設定交易參數
- 建議從小額資金開始，逐步增加交易規模
- 請確保充足的資金餘額以應對市場波動
- 定期檢查和調整風險控制參數
- **請確保您的API密鑰具有適當的權限設置**

## ✅ 開發進度

### 已完成功能 ✅

#### 🏗️ 基礎架構
- [x] 項目架構搭建 (前後端分離)
- [x] React + Redux 前端框架
- [x] Python FastAPI 後端API
- [x] WebSocket 即時數據推送
- [x] 品牌重構：Arbitrade

#### 🔧 系統修復 (最新)
- [x] **API路由統一** - 修復前端API調用與後端路由不一致問題
- [x] **數據結構對齊** - 修復前後端數據結構不匹配問題
- [x] **WebSocket連接優化** - 修復WebSocket連接和消息處理問題
- [x] **套利引擎邏輯修復** - 修復觸發條件和執行邏輯
- [x] **前端界面優化** - 修復價格顯示和交互問題

#### 💰 交易所集成
- [x] **Bybit API 集成** (真實平台)
  - [x] 官方 Node.js SDK 集成
  - [x] 賬戶信息查詢
  - [x] 即時價格訂閱
  - [x] 訂單簿數據獲取
  - [x] 下單功能 (市價/限價)
  - [x] WebSocket 即時數據

#### 🔄 雙腿套利系統
- [x] **套利監控面板**
  - [x] 交易對選擇 (支援跨交易所)
  - [x] 價差閾值設定
  - [x] bid1/ask1 即時監控
  - [x] 一鍵雙邊下單
  - [x] 監控配置管理

#### ⏱️ TWAP 策略 (雙腿版本)
- [x] **雙腿TWAP執行**
  - [x] Leg1 + Leg2 獨立配置
  - [x] 支援不同交易所組合
  - [x] 現貨/合約混合策略
  - [x] 智能訂單分割
  - [x] 即時執行進度監控
  - [x] 暫停/恢復/取消功能

#### ⚙️ 系統設定
- [x] **API設定管理**
  - [x] Bybit API 密鑰配置
  - [x] 真實交易平台 (非測試網)
  - [x] API 連接測試
  - [x] 環境變量持久化保存
- [x] **風險控制**
  - [x] 最大持倉限制
  - [x] 日損失限制
  - [x] 價格偏差閾值

#### 🎨 用戶界面
- [x] 現代化專業設計
- [x] 響應式布局
- [x] 即時狀態顯示
- [x] 直觀的操作流程
- [x] 完善的錯誤提示

#### 🔧 最新修復 (2025-01-19)
- [x] **價格API分類修復**
  - [x] 修正前端價格獲取邏輯，根據交易對類型（linear/spot）調用正確的API
  - [x] 後端API支持category參數，確保獲取正確的合約/現貨價格
  - [x] 修正幣別符號顯示，使用base幣別（如BTCUSDT → BTC）
- [x] **數據載入優化**
  - [x] 優先使用WebSocket實時數據
  - [x] 添加5秒緩存機制減少HTTP請求
  - [x] 提供手動"載入價格"按鈕
- [x] **執行記錄功能**
  - [x] 在套利頁面添加"最近執行記錄"區塊
  - [x] 支持刷新和清除記錄功能
- [x] **表格渲染錯誤修復** ✅
  - [x] 修復雙腿下單頁面刷新歷史數據後出現的 leg1 undefined 錯誤
  - [x] 加強表格列渲染的防禦性編程，避免數據不完整導致的渲染錯誤
  - [x] 優化數據驗證邏輯，確保只有完整的數據才會被渲染到表格中
  - [x] 修復最近執行記錄的數據結構，確保所有必要屬性都存在
- [x] **數據持久化修復** ✅
  - [x] 修復頁面刷新後交易對數據丟失的問題
  - [x] 移除 App.tsx 中清空緩存的邏輯，避免刷新後數據丟失
  - [x] 改善數據載入機制，優先從後端載入，失敗時從本地存儲載入
  - [x] 加強 Redux store 初始化的錯誤處理，確保數據穩定性
- [x] **套利引擎狀態修復** ✅
  - [x] 修復 Dashboard 頁面無法正確顯示套利引擎運行狀態的問題
  - [x] 添加引擎狀態的 Redux 更新邏輯，確保狀態同步
  - [x] 改善引擎控制按鈕的響應性，提供即時狀態反饋
  - [x] 優化數據載入流程，確保引擎狀態正確載入和顯示

### 待開發功能 🚧

#### 🌐 多交易所支援
- [ ] **Binance 集成**
  - [ ] API SDK 集成
  - [ ] 現貨/合約交易
  - [ ] 即時數據訂閱
- [ ] **OKX 集成**
  - [ ] API SDK 集成
  - [ ] 統一交易接口
- [ ] **Bitget 集成**
  - [ ] API SDK 集成
  - [ ] 跨所套利支援

#### 📊 高級分析工具
- [ ] **實時分析儀表板**
  - [ ] 價差歷史圖表
  - [ ] 套利機會統計
  - [ ] 盈虧分析報表
- [ ] **策略績效追蹤**
  - [ ] 收益率計算
  - [ ] 風險指標監控
  - [ ] 交易統計分析

#### 🧪 策略回測系統
- [ ] **歷史數據回測**
  - [ ] 策略參數優化
  - [ ] 風險評估模型
  - [ ] 績效比較分析
- [ ] **模擬交易環境**
  - [ ] 虛擬資金測試
  - [ ] 策略驗證平台

#### 🤖 智能化功能
- [ ] **自動套利執行**
  - [ ] 智能觸發機制
  - [ ] 風險自動控制
  - [ ] 異常情況處理
- [ ] **機器學習優化**
  - [ ] 價差預測模型
  - [ ] 最優參數推薦

#### 📱 移動端支援
- [ ] **響應式優化**
  - [ ] 移動端界面適配
  - [ ] 觸控操作優化
- [ ] **推送通知**
  - [ ] 套利機會提醒
  - [ ] 交易狀態通知

#### 🔒 安全性增強
- [ ] **用戶認證系統**
  - [ ] 登錄/註冊功能
  - [ ] 權限管理
- [ ] **API密鑰加密**
  - [ ] 本地加密存儲
  - [ ] 安全傳輸協議

#### 📈 高級交易功能
- [ ] **網格交易策略**
  - [ ] 自動網格布局
  - [ ] 動態參數調整
- [ ] **DCA (定投) 策略**
  - [ ] 分批建倉
  - [ ] 成本平均化

#### 🔧 系統優化
- [ ] **性能優化**
  - [ ] 數據庫集成
  - [ ] 緩存機制
  - [ ] 負載均衡
- [ ] **監控告警**
  - [ ] 系統健康監控
  - [ ] 異常告警機制

## 📋 開發優先級

### 🔥 高優先級 (下個版本)
1. **Binance API 集成** - 擴展交易所支援
2. **實時分析儀表板** - 提升用戶體驗
3. **自動套利執行** - 核心功能增強
4. **數據庫集成** - 數據持久化

### 🟡 中優先級 (後續版本)
1. **OKX & Bitget 集成** - 完善多交易所
2. **策略回測系統** - 風險評估工具
3. **移動端優化** - 擴大使用場景
4. **用戶認證系統** - 多用戶支援

### 🟢 低優先級 (長期規劃)
1. **機器學習優化** - AI 增強功能
2. **高級交易策略** - 網格、DCA等
3. **API密鑰加密** - 安全性增強
4. **負載均衡** - 高可用性

## ⏰ 預估開發時間

| 功能模塊 | 預估時間 | 複雜度 |
|---------|---------|--------|
| Binance 集成 | 1-2週 | 中等 |
| 實時分析儀表板 | 2-3週 | 高 |
| 自動套利執行 | 3-4週 | 高 |
| 數據庫集成 | 1-2週 | 中等 |

| 移動端優化 | 2-3週 | 中等 |
| 用戶認證系統 | 2-3週 | 中等 |


## 🚀 快速開始

### 1. 安裝依賴
```bash
# 安裝所有依賴
npm run install:all
```

### 2. 配置環境
```bash
cd server
cp env.example .env
# 編輯 .env 文件，配置 Bybit API 密鑰
```

### 3. 啟動系統
```bash
# 開發模式（同時啟動前後端）
npm run dev
```

### 4. 訪問系統
- 前端界面：http://localhost:3000
- 後端API：http://localhost:5000

### 5. 開始使用
1. 在「雙腿套利」頁面添加監控交易對
2. 設定觸發閾值和交易數量
3. 啟用監控，等待套利機會
4. 在「TWAP策略」頁面創建分散執行策略

📖 **詳細安裝指南**：請參考 [INSTALLATION.md](./INSTALLATION.md)

📘 **工程師快速上手**：請參考 [ONBOARDING.md](./ONBOARDING.md)

## 📚 技術文檔

### 🏗️ 架構設計
- **[後端重構建議](./BACKEND_REFACTOR_RECOMMENDATIONS.md)** - 多交易所擴展的專業建議
- **[系統架構文檔](./SYSTEM_ARCHITECTURE.md)** - 完整的系統架構設計
- **[開發指南](./DEVELOPMENT_GUIDE.md)** - 詳細的開發文檔和API說明
- **[實施計劃](./IMPLEMENTATION_PLAN.md)** - 分階段重構實施計劃

### 🔧 開發資源
- **API 文檔**：完整的 REST API 接口說明
- **數據庫設計**：MongoDB 和 Redis 數據模型
- **交易所集成**：多交易所適配器實現指南
- **部署指南**：Docker 和生產環境部署說明
- **測試指南**：單元測試、集成測試和端到端測試
- **故障排除**：常見問題和解決方案

## 🎯 主要功能演示

### 雙腿套利
- ✅ 支援 Bybit 合約和現貨
- ✅ 即時 bid1/ask1 價差監控
- ✅ 用戶自定義觸發閾值
- ✅ 一鍵手動執行套利
- ✅ 自動風險控制

### TWAP策略  
- ✅ 用戶自定義標的和數量
- ✅ 靈活的時間間隔設定
- ✅ 智能訂單分割
- ✅ 即時執行進度監控
- ✅ 支援暫停/恢復/取消

### 專業界面
- ✅ 現代化專業界面設計
- ✅ 即時數據推送和更新
- ✅ 完善的風險提示
- ✅ 直觀的操作流程

## 聯繫支援
如有任何問題或建議，請通過以下方式聯繫：
- 項目維護者：AI助手
- 技術支援：提供24/7技術支援服務

---
**⚠️ 風險提示**：*本項目遵循最佳安全實踐，加密貨幣交易存在高風險，請在充分理解風險的前提下使用。*
#   a r b i t r a d e 
 
 